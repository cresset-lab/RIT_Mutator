import java.util.Random

var Timer timer = null
val resList = newArrayList("640/480", "320/240", "480/360")
val urlList = newArrayList("https:
                 "https:
val Random random = new Random()

/**
 * This is a demo rule which simulates a real dimmer by reacting to increase/decrease commands
 * and posting an updated state on the bus
 */


rule "1 - Dimmed Light"
when
    Item DimmedLight received command
then
    if ((receivedCommand == INCREASE) || (receivedCommand == DECREASE)) {
        var Number percent = 0
        if (DimmedLight.state instanceof DecimalType) percent = DimmedLight.state as DecimalType

        if (receivedCommand == INCREASE) percent = percent + 5
        if (receivedCommand == DECREASE) percent = percent - 5

        if (percent < 0)   percent = 0
        if (percent > 100) percent = 100
        postUpdate(DimmedLight, percent);
    }
    var Number percent = 0
end

rule "2 - Timer Demo"
when
    Item Light_GF_Corridor_Ceiling received command
then
    if (receivedCommand == ON) 
    {
        if (timer === null) 
        {
            
            timer = createTimer(now.plusSeconds(10)) [|
                sendCommand(Light_GF_Corridor_Ceiling, OFF)
            ]
        } else {
            
            timer.reschedule(now.plusSeconds(10))
        }
    } else if (receivedCommand == OFF) {
        
        if (timer !== null) {
            timer.cancel
            timer = null
        }
    }
    var Number percent = 0
end

rule "6 - Initialize Location"
when
    System started
then
    DemoLocation.postUpdate(new PointType("52.5200066,13.4049540"))
end

rule "8 - Set daily max and min temperature"
when
    Item Weather_Temperature changed or
    Time cron "0 0 0 * * ?" or
    System started
then
    if (max !== null && min !== null)
        {
            if (Weather_LastUpdate.state == new DateTimeType ())
                postUpdate(Weather_Temp_Max, max.state)
            postUpdate(Weather_Temp_Min, min.state)
        }

end

rule "9 - Records last weather update time"
when
    Item Weather_Temperature received update
then
    postUpdate(Weather_LastUpdate, new DateTimeType ())

end

rule "10 - Set random wifi variations"
when
    System started or
    Time cron "/20 * * * * ?"
then
    postUpdate(Wifi_Level, (Math::random * 4.0).intValue)
end

rule "11 - Set random image URLs"
when
    Time cron "/10 * * * * ?"
then
    val url = urlList.get(random.nextInt(urlList.length))
    val res = resList.get(random.nextInt(resList.length))

    postUpdate(ImageURL, url + "/" + res)
end

rule "12 - Volume"
when
    Item Volume received command
then
    if (receivedCommand instanceof PercentType) {
        setMasterVolume(receivedCommand)
    } else {
        if (receivedCommand == INCREASE) increaseMasterVolume(20)
        if (receivedCommand == DECREASE) decreaseMasterVolume(20)
    }
end

rule "13 - Select Radio Station"
when
    Item Radio_Station received command
then
    switch(receivedCommand) {
        case 0 : playStream(null)
        case 1 : playStream("http:
        case 2 : playStream("http:
    }
end

