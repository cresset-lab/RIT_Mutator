rule "6 - Irrigation - valve updated, turn on the timer"
when
    Item GroupIrrigationValves changed
then
    if (GroupIrrigationValves.state == ON)
        {
            if (IrrigationTimerMax.state == OFF)
                {
                    logDebug(logName, "Irrigation valve open, starting protection timer")
                    IrrigationTimerMax.sendCommand(ON)
                }
            else {
                logDebug(logName, "Irrigation valve open, timer already started, nothing to do")
            }
        }
    else {
        logDebug(logName, "All irrigation valves closed, stopping protection timer")
        IrrigationTimerMax.postUpdate(OFF)
    }

end

rule "7 - Irrigation - protection timer off, close all valves"
when
    Item IrrigationTimerMax changed to OFF
then
    logWarn(logName, "Irrigation protection timer expired - close all valves")
    IrrigationTimerMax.sendCommand(OFF)

end