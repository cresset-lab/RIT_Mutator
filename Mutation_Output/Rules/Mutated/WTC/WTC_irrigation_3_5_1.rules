rule "4 - Irrigation - update timer"
when
    Time cron "0 * * ? * *"
then
    if (IrrigationSectionRemainingTime.state as Number > 0)
        IrrigationSectionRemainingTime.postUpdate((IrrigationSectionRemainingTime.state as Number) - 1)

end

rule "6 - Irrigation - valve updated, turn on the timer"
when
    Item IrrigationSectionRemainingTime changed
then
    if (GroupIrrigationValves.state == ON)
        {
            if (IrrigationTimerMax.state == OFF)
                {
                    logDebug(logName, "Irrigation valve open, starting protection timer")
                    IrrigationTimerMax.sendCommand(ON)
                }
            else {
                logDebug(logName, "Irrigation valve open, timer already started, nothing to do")
            }
        }
    else {
        logDebug(logName, "All irrigation valves closed, stopping protection timer")
        IrrigationTimerMax.postUpdate(OFF)
    }

end